"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/request.js"),o={data:()=>({feedback:{q1:null,q2:null,q3:null,like1:"",like2:"",like3:"",improve1:"",improve2:"",improve3:"",q6:null,q7:null,q8:null,otherFeedback:""},questionnaireId:1,userId:"",submitting:!1}),onLoad(){const t=e.index.getStorageSync("userInfo");t?(this.userId=t.userId||t.id,console.log("获取到用户ID:",this.userId)):(this.userId="anonymous_"+(new Date).getTime(),console.log("使用匿名ID:",this.userId))},methods:{selectOption(e,t){this.feedback[e]=t},inputChange(e,t){this.feedback[e]=t.detail.value},submitFeedback(){if(["q1","q2","q3","q6","q7","q8"].filter((e=>null===this.feedback[e])).length>0)return void e.index.showToast({title:"请回答所有单选题",icon:"none"});if(this.submitting)return;this.submitting=!0;const o=[];Object.keys(this.feedback).forEach((e=>{if(null===this.feedback[e]||""===this.feedback[e])return;let t;switch(e){case"q1":t=1;break;case"q2":t=2;break;case"q3":t=3;break;case"like1":case"like2":case"like3":t=4;break;case"improve1":case"improve2":case"improve3":t=5;break;case"q6":t=6;break;case"q7":t=7;break;case"q8":t=8;break;case"otherFeedback":t=9}o.push({questionnaireId:this.questionnaireId,questionId:t,userId:this.userId||"anonymous",userType:this.userId?1:0,content:this.feedback[e].toString()})})),t.request.submitAnswers(o).then((t=>{0===t.code?(e.index.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{e.index.reLaunch({url:"/pages/home/home"})}),1500)):e.index.showToast({title:t.msg||"提交失败",icon:"none"})})).catch((t=>{console.error("提交失败:",t),e.index.showToast({title:"提交失败，请稍后重试",icon:"none"})})).finally((()=>{this.submitting=!1}))},goBack(){e.index.navigateBack()}}};const i=e._export_sfc(o,[["render",function(t,o,i,a,s,c){return{a:1===s.feedback.q1?1:"",b:e.o((e=>c.selectOption("q1",1))),c:2===s.feedback.q1?1:"",d:e.o((e=>c.selectOption("q1",2))),e:3===s.feedback.q1?1:"",f:e.o((e=>c.selectOption("q1",3))),g:4===s.feedback.q1?1:"",h:e.o((e=>c.selectOption("q1",4))),i:5===s.feedback.q1?1:"",j:e.o((e=>c.selectOption("q1",5))),k:1===s.feedback.q2?1:"",l:e.o((e=>c.selectOption("q2",1))),m:2===s.feedback.q2?1:"",n:e.o((e=>c.selectOption("q2",2))),o:3===s.feedback.q2?1:"",p:e.o((e=>c.selectOption("q2",3))),q:4===s.feedback.q2?1:"",r:e.o((e=>c.selectOption("q2",4))),s:5===s.feedback.q2?1:"",t:e.o((e=>c.selectOption("q2",5))),v:1===s.feedback.q3?1:"",w:e.o((e=>c.selectOption("q3",1))),x:2===s.feedback.q3?1:"",y:e.o((e=>c.selectOption("q3",2))),z:3===s.feedback.q3?1:"",A:e.o((e=>c.selectOption("q3",3))),B:4===s.feedback.q3?1:"",C:e.o((e=>c.selectOption("q3",4))),D:5===s.feedback.q3?1:"",E:e.o((e=>c.selectOption("q3",5))),F:e.o((e=>c.inputChange("like1",e))),G:e.o((e=>c.inputChange("like2",e))),H:e.o((e=>c.inputChange("like3",e))),I:e.o((e=>c.inputChange("improve1",e))),J:e.o((e=>c.inputChange("improve2",e))),K:e.o((e=>c.inputChange("improve3",e))),L:1===s.feedback.q6?1:"",M:e.o((e=>c.selectOption("q6",1))),N:2===s.feedback.q6?1:"",O:e.o((e=>c.selectOption("q6",2))),P:3===s.feedback.q6?1:"",Q:e.o((e=>c.selectOption("q6",3))),R:4===s.feedback.q6?1:"",S:e.o((e=>c.selectOption("q6",4))),T:5===s.feedback.q6?1:"",U:e.o((e=>c.selectOption("q6",5))),V:1===s.feedback.q7?1:"",W:e.o((e=>c.selectOption("q7",1))),X:2===s.feedback.q7?1:"",Y:e.o((e=>c.selectOption("q7",2))),Z:3===s.feedback.q7?1:"",aa:e.o((e=>c.selectOption("q7",3))),ab:4===s.feedback.q7?1:"",ac:e.o((e=>c.selectOption("q7",4))),ad:5===s.feedback.q7?1:"",ae:e.o((e=>c.selectOption("q7",5))),af:1===s.feedback.q8?1:"",ag:e.o((e=>c.selectOption("q8",1))),ah:2===s.feedback.q8?1:"",ai:e.o((e=>c.selectOption("q8",2))),aj:3===s.feedback.q8?1:"",ak:e.o((e=>c.selectOption("q8",3))),al:4===s.feedback.q8?1:"",am:e.o((e=>c.selectOption("q8",4))),an:5===s.feedback.q8?1:"",ao:e.o((e=>c.selectOption("q8",5))),ap:e.o((e=>c.inputChange("otherFeedback",e))),aq:e.o(((...e)=>c.submitFeedback&&c.submitFeedback(...e))),ar:e.o(((...e)=>c.goBack&&c.goBack(...e)))}}]]);wx.createPage(i);
